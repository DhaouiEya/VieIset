<div class="container-fluid vh-100">
  <div class="row h-100">

    <!-- Formulaire -->
    <div class="col-md-6 d-flex align-items-center justify-content-center form-col">
      <form class="reset-form w-100" novalidate [formGroup]="resetPasswordForm" (ngSubmit)="submit()">
        <div class="form-inner px-4" style="max-width: 450px; margin: auto;">

          <!-- Heading -->
          <div class="text-center mb-6">
            <h1 class="form-title mb-2">Réinitialiser votre mot de passe</h1>
            <p class="form-subtitle">Entrez votre nouveau mot de passe.</p>
          </div>

          <!-- Alert erreur -->
          <ng-container *ngIf="errorState === errorStates.HasError">
            <div class="alert alert-danger mb-4">{{ message }}</div>
          </ng-container>

          <!-- Message succès -->
          <ng-container *ngIf="errorState === errorStates.NoError">
            <section class="d-flex justify-content-center align-items-center mb-4">
              <div class="bg-light-info p-4 rounded shadow-sm w-100 text-center">
                <div class="text-info fw-semibold">Mot de passe réinitialisé avec succès</div>
              </div>
            </section>
          </ng-container>

          <!-- Champ mot de passe -->
          <div class="fv-row mb-4">
            <label class="form-label fw-bolder text-gray-900 fs-6 mb-2">Mot de passe</label>
              <input
                class="form-control bg-transparent"
                type="password"
                placeholder="Nouveau mot de passe"
                formControlName="password"
                id="passwordField"
                [ngClass]="{
                  'is-invalid': resetPasswordForm.controls['password'].invalid && (resetPasswordForm.controls['password'].dirty || resetPasswordForm.controls['password'].touched),
                  'is-valid': resetPasswordForm.controls['password'].valid && (resetPasswordForm.controls['password'].dirty || resetPasswordForm.controls['password'].touched)
                }"
              />
                          <div class="mt-2">

               <password-strength-meter [password]="resetPasswordForm.get('password')?.value" [minPasswordLength]="6"
                [numberOfProgressBarItems]="4" [colors]="['#e74c3c', '#f39c12', '#f1c40f', '#2ecc71']"
                [enableFeedback]="false">
              </password-strength-meter>

            <!-- Validation -->
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'required',
                message: 'Le mot de passe est requis',
                control: resetPasswordForm.controls['password']
              }"></ng-container>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'minlength',
                message: 'Le mot de passe doit contenir au moins 6 caractères',
                control: resetPasswordForm.controls['password']
              }"></ng-container>
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'maxlength',
                message: 'Le mot de passe doit comporter au maximum 100 caractères',
                control: resetPasswordForm.controls['password']
              }"></ng-container>
              </div>
          </div>

          <!-- Champ confirmer mot de passe -->
          <div class="fv-row mb-6">
            <label class="form-label fw-bolder text-gray-900 fs-6 mb-2">Confirmer le mot de passe</label>
            <input
              type="password"
              class="form-control bg-transparent"
              placeholder="Confirmer le mot de passe"
              formControlName="cPassword"
              [ngClass]="{
                'is-invalid': resetPasswordForm.controls['cPassword'].invalid && (resetPasswordForm.controls['cPassword'].dirty || resetPasswordForm.controls['cPassword'].touched),
                'is-valid': resetPasswordForm.controls['cPassword'].valid && (resetPasswordForm.controls['cPassword'].dirty || resetPasswordForm.controls['cPassword'].touched)
              }"
            />
            <ng-container [ngTemplateOutlet]="formError" [ngTemplateOutletContext]="{
                validation: 'required',
                message: 'Le mot de passe de confirmation est requis',
                control: resetPasswordForm.controls['cPassword']
              }"></ng-container>
            <ng-container *ngIf="
                resetPasswordForm.controls['cPassword'].errors &&
                resetPasswordForm.controls['cPassword'].errors?.['ConfirmPassword']
              ">
              <div class="fv-plugins-message-container">
                <div class="fv-help-block text-danger">
                  <span role="alert">Les mots de passe ne correspondent pas</span>
                </div>
              </div>
            </ng-container>
          </div>

          <!-- Boutons -->
          <div class="d-flex flex-wrap justify-content-center gap-3">
            <button type="submit" class="btn btn-primary btn-lg" [disabled]="resetPasswordForm.invalid">
              Envoyer
            </button>
            <a routerLink="/login" class="btn btn-light btn-lg">Annuler</a>
          </div>

        </div>
      </form>

      <!-- Template erreur champ -->
      <ng-template #formError let-control="control" let-message="message" let-validation="validation">
        <ng-container *ngIf="control.hasError(validation) && (control.dirty || control.touched)">
          <div class="fv-plugins-message-container text-danger mt-1" role="alert">
            <span>{{ message }}</span>
          </div>
        </ng-container>
      </ng-template>
    </div>

    <!-- Image -->
    <div class="col-md-6 d-none d-md-block p-0">
      <img src="forgetPassword.jpg" alt="Réinitialisation mot de passe" class="img-fluid h-100 w-100 object-fit-cover">
    </div>

  </div>
</div>

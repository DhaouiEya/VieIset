<app-header></app-header>

<div class="container-fluid vh-100">
  <div class="row h-100">

    <!-- Formulaire -->
    <div class="col-md-6 d-flex align-items-center justify-content-center form-col">

      <form class="forgot-form w-100" novalidate [formGroup]="forgotPasswordForm" (ngSubmit)="submit()">
        <div class="form-inner px-4" style="max-width: 450px; margin: auto;">

          <!-- Heading -->
          <div class="text-center mb-6">
            <h1 class="form-title mb-2">Mot de passe oublié ?</h1>
            <p class="form-subtitle">Entrez votre email pour réinitialiser votre mot de passe.</p>
          </div>

          <!-- Alert erreur -->
          <ng-container *ngIf="errorState === errorStates.HasError">
            <div class="alert alert-danger mb-4">{{ message }}</div>
          </ng-container>

          <!-- Message succès -->


<ng-container *ngIf="sent && errorState === errorStates.NoError">
  <section class="d-flex justify-content-center align-items-center min-vh-50 p-5">
    <div class="bg-light border rounded p-6 m-3 shadow-sm " role="alert" aria-live="polite">

      <h4 class="fw-bold text-success mb-3">E-mail envoyé !</h4>
      <p class="mb-2">Un lien de réinitialisation a été envoyé à votre adresse e-mail.</p>
      <p class="text-muted small">Vérifiez votre dossier <strong>spam</strong> si vous ne le trouvez pas.</p>
      <div class="text-center mt-4">
        <a routerLink="/login" class="btn btn-primary px-4 py-2" aria-label="Retourner à la page de connexion">Revenir à la connexion</a>
      </div>
    </div>
  </section>
</ng-container>

          <!-- Formulaire email -->
          <div *ngIf="!sent" class="mb-6">
            <label class="form-label fw-semibold">Email</label>
            <input type="email" formControlName="email" placeholder="Email" class="form-control form-control-lg"
              [ngClass]="{
                'is-invalid': f['email'].invalid && (f['email'].dirty || f['email'].touched),
                'is-valid': f['email'].valid && (f['email'].dirty || f['email'].touched)
              }" />
          </div>

          <!-- Boutons -->
          <div *ngIf="!sent" class="d-flex justify-content-center gap-3">
            <button type="submit" class="btn btn-primary btn-lg" [disabled]="forgotPasswordForm.invalid">
              Envoyer
            </button>
            <a routerLink="/auth/login" class="btn btn-light btn-lg">Annuler</a>
          </div>

        </div>
      </form>

      <!-- Template erreur champ -->
      <ng-template #formError let-control="control" let-message="message" let-validation="validation">
        <ng-container *ngIf="control.hasError(validation) && (control.dirty || control.touched)">
          <div class="fv-plugins-message-container text-danger mt-1" role="alert">
            <span>{{ message }}</span>
          </div>
        </ng-container>
      </ng-template>
    </div>

    <!-- Image -->
    <div class="col-md-6 d-none d-md-block p-0">
      <img src="forgetPassword.jpg" alt="Image d'inscription" class="img-fluid h-100 w-100 object-fit-cover">
    </div>

  </div>
</div>

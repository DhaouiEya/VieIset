<div class="container-fluid py-3 admin-dashboard">
  <div class="row g-3">
    <!-- üìù SIDEBAR -->
    <div class="col-lg-2 d-none d-lg-block">
      <app-admin-menu></app-admin-menu>
    </div>

    <!-- üìù CONTENU PRINCIPAL -->
    <div class="col-lg-10">
      <div class="row g-3">
        <!-- üìù FORMULAIRE DE CR√âATION -->
        <div class="col-lg-8">
          <div class="card modern-card shadow-sm border-0 mb-3">
            <div class="card-header bg-primary text-white py-2">
              <div class="d-flex align-items-center">
                <i class="fas fa-plus-circle me-2 fs-6"></i>
                <h4 class="mb-0 fw-bold">Cr√©er une nouvelle campagne</h4>
              </div>
            </div>
            <div class="card-body p-3">
              <form (ngSubmit)="onSubmit()" [formGroup]="compagneForm" class="needs-validation" novalidate>
                <div class="mb-3">
                  <label class="form-label fw-semibold text-dark">Type de campagne</label>
                  <select formControlName="title" class="form-select modern-select">
                    <option value="aide_etudiant">üéì Aide pour √©tudiant dans le besoin</option>
                    <option value="aide_club">üèÜ Aide pour les clubs universitaires</option>
                    <option value="projet_educatif">üí° Projet √©ducatif innovant</option>
                  </select>
                </div>

                <div class="mb-3">
                  <label class="form-label fw-semibold text-dark">Description</label>
                  <textarea formControlName="description" rows="3"
                            class="form-control modern-textarea"
                            placeholder="D√©crivez l'objectif de votre campagne..."></textarea>
                </div>

                <div class="row g-2 mb-3">
                  <div class="col-md-6">
                    <label class="form-label fw-semibold text-dark">
                      <i class="fas fa-calendar-start me-1 text-primary"></i>Date d√©but
                    </label>
                    <input type="date" formControlName="dateDebut"
                           class="form-control modern-input">
                  </div>
                  <div class="col-md-6">
                    <label class="form-label fw-semibold text-dark">
                      <i class="fas fa-calendar-check me-1 text-primary"></i>Date fin
                    </label>
                    <input type="date" formControlName="dateFin"
                           class="form-control modern-input">
                  </div>

                  @if (compagneForm.errors?.['dateInvalid']) {
                    <div class="col-12">
                      <div class="alert alert-warning d-flex align-items-center mt-1" role="alert">
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        <small>‚ö†Ô∏è La date de fin doit √™tre post√©rieure √† la date de d√©but.</small>
                      </div>
                    </div>
                  }
                </div>

                <div class="mb-3">
                  <label class="form-label fw-semibold text-dark">
                    <i class="fas fa-bullseye me-1 text-primary"></i>Objectif montant (DT)
                  </label>
                  <div class="input-group">
                    <span class="input-group-text bg-light border-end-0">üí∞</span>
                    <input type="number" formControlName="objectif_montant"
                           class="form-control modern-input border-start-0"
                           placeholder="Montant cible">
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label fw-semibold text-dark">
                    <i class="fas fa-user-graduate me-1 text-primary"></i>B√©n√©ficiaire
                  </label>
                 <select formControlName="beneficiaire" class="form-select">
  <!-- Optional: a default "please select" option -->
  <option value="">-- Choisir un b√©n√©ficiaire --</option>

  @for (e of etudiants; track e._id) {
    <option [value]="e._id">
      {{ e.firstName }} {{ e.lastName }} - {{ e.email }}
    </option>
  }
</select>
                </div>

                <button type="submit" class="btn btn-primary w-100 modern-btn">
                  <i class="fas fa-rocket me-1"></i>
                  Publier la campagne
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- üìä LISTE DES CAMPAGNES -->
        <div class="col-lg-4">
          <div class="card modern-card shadow-sm border-0">
            <div class="card-header bg-gradient-primary text-white py-2">
              <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                  <i class="fas fa-chart-line me-2 fs-6"></i>
                 <h4 class="fw-bold mb-2 text-primary">
    <i class="fas fa-heart me-2 text-danger"></i> Campagnes de dons
  </h4>
  <span class="badge bg-light text-primary fs-6 px-3 py-2 shadow-sm">
    {{ compagnes.length }} campagne(s)
  </span>
                </div>

              </div>
            </div>
            <div class="card-body p-3">
              <div class="campaigns-list">
                @for (campagne of compagnes; track campagne._id) {
                  <div class="campaign-item card border-0 mb-3 shadow-sm hover-lift"
                       [class.completed]="(campagne.montant_collecte / campagne.objectif_montant * 100) >= 100"
                       [class.ongoing]="(campagne.montant_collecte / campagne.objectif_montant * 100) < 100">
                    <div class="card-body p-3">
                      <div class="d-flex justify-content-between align-items-start mb-2">
                        <div class="d-flex align-items-center">
                          <div class="campaign-icon bg-primary text-white rounded-2 p-1 me-2">
                            <i class="fas fa-hand-holding-heart fs-6"></i>
                          </div>
                          <div>
                            <h6 class="fw-bold mb-0 text-dark">{{ campagne.title }}</h6>
                            <p class="text-muted mb-0 small">{{ campagne.description }}...</p>
                          </div>
                        </div>
                        <span class="badge status-badge"
                              [class.bg-success]="(campagne.montant_collecte / campagne.objectif_montant * 100) >= 100"
                              [class.bg-warning]="(campagne.montant_collecte / campagne.objectif_montant * 100) < 100">
                          @if ((campagne.montant_collecte / campagne.objectif_montant * 100) >= 100) {
                            <i class="fas fa-check me-1"></i>Atteint
                          } @else {
                            <i class="fas fa-spinner me-1"></i>En cours
                          }
                        </span>
                      </div>

                      <!-- Barre de progression -->
                      <div class="mb-2">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                          <span class="text-muted small">Progression</span>
                          <span class="fw-bold text-primary small">
                            {{ (campagne.montant_collecte / campagne.objectif_montant * 100).toFixed(1) }}%
                          </span>
                        </div>
                        <div class="progress modern-progress">
                          <div class="progress-bar progress-bar-striped progress-bar-animated"
                               [class.bg-success]="(campagne.montant_collecte / campagne.objectif_montant * 100) >= 100"
                               [class.bg-primary]="(campagne.montant_collecte / campagne.objectif_montant * 100) < 100"
                               [style.width.%]="campagne.montant_collecte / campagne.objectif_montant * 100">
                          </div>
                        </div>
                      </div>

                      <!-- Statistiques -->
                      <div class="row text-center">
                        <div class="col-6">
                          <div class="stat-card p-1 rounded-2 bg-light">
                            <div class="fw-bold text-success fs-6">{{ campagne.montant_collecte }} DT</div>
                            <small class="text-muted">Collect√©s</small>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="stat-card p-1 rounded-2 bg-light">
                            <div class="fw-bold text-dark fs-6">{{ campagne.objectif_montant }} DT</div>
                            <small class="text-muted">Objectif</small>
                          </div>
                        </div>
                      </div>

                      <!-- Dates -->
                      <div class="d-flex justify-content-between mt-2 pt-2 border-top">
                        <small class="text-muted">
                          <i class="fas fa-play-circle me-1 text-success"></i>
                          {{ campagne.dateDebut | date:'dd/MM/yyyy' }}
                        </small>
                        <small class="text-muted">
                          <i class="fas fa-flag-checkered me-1 text-primary"></i>
                          {{ campagne.dateFin | date:'dd/MM/yyyy' }}
                        </small>
                      </div>
                    </div>
                  </div>
                } @empty {
                  <div class="text-center py-4">
                    <i class="fas fa-inbox fa-2x text-muted mb-2"></i>
                    <h6 class="text-muted">Aucune campagne pour le moment</h6>
                    <p class="text-muted small">Cr√©ez votre premi√®re campagne pour commencer</p>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
